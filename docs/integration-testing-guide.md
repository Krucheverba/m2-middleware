# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Integration —Ç–µ—Å—Ç–∞–º

## –û–±–∑–æ—Ä

Integration —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –º–æ–∫–∞–º–∏ –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö API.

## End-to-End Integration —Ç–µ—Å—Ç—ã

–§–∞–π–ª: `test-integration-e2e.js`

### –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### 1. End-to-end —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–ø–ø–∏–Ω–≥–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞
- –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏–∑ –ú–æ–π–°–∫–ª–∞–¥ –ø–æ product.id
- –ú–∞–ø–ø–∏–Ω–≥ product.id ‚Üí offerId
- –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤ M2 —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ offerId

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** 1.5, 2.5, 5.5

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- –í—Å–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –º–∞–ø–ø–∏–Ω–≥–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ offerId –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ M2
- –û—Å—Ç–∞—Ç–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã (total - reserve)

#### 2. End-to-end –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∏–∑ M2 —Å offerId
- –û–±—Ä–∞—Ç–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ offerId ‚Üí product.id
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –ú–æ–π–°–∫–ª–∞–¥ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ product.id
- –ü—Ä–æ–ø—É—Å–∫ –ø–æ–∑–∏—Ü–∏–π –±–µ–∑ –º–∞–ø–ø–∏–Ω–≥–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞ –∑–∞–∫–∞–∑–æ–≤

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** 2.5, 7.5

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω –≤ –ú–æ–π–°–∫–ª–∞–¥
- –ü–æ–∑–∏—Ü–∏–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ product.id
- –ù–µ–º–∞–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–æ–ø—É—â–µ–Ω—ã
- –ú–∞–ø–ø–∏–Ω–≥ –∑–∞–∫–∞–∑–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook —Å product.id

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- –ó–∞–ø—É—Å–∫ webhook endpoint
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ product.id –∏–∑ webhook payload
- –ú–∞–ø–ø–∏–Ω–≥ product.id ‚Üí offerId
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤ M2
- –í–æ–∑–≤—Ä–∞—Ç HTTP 200 OK

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** 4.5

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- Webhook –ø—Ä–∏–Ω—è—Ç (—Å—Ç–∞—Ç—É—Å 200)
- product.id –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω –∏–∑ event.meta.href
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π offerId –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –º–∞–ø–ø–∏–Ω–≥
- –û—Å—Ç–∞—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ M2

#### 4. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–æ–≤

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ –∏–∑ –ú–æ–π–°–∫–ª–∞–¥
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–æ–≤ product.id ‚Üí offerId –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–æ–≤ –≤ —Ñ–∞–π–ª
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –º–∞–ø–ø–∏–Ω–≥–∞

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** 10.5

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- –í—Å–µ —Ç–æ–≤–∞—Ä—ã —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º offerId –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã
- –¢–æ–≤–∞—Ä—ã –±–µ–∑ –∞—Ç—Ä–∏–±—É—Ç–∞ –ø—Ä–æ–ø—É—â–µ–Ω—ã
- –§–∞–π–ª –º–∞–ø–ø–∏–Ω–≥–∞ —Å–æ–∑–¥–∞–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –º–∞–ø–ø–∏–Ω–≥–æ–≤ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö integration —Ç–µ—Å—Ç–æ–≤

```bash
node test-integration-e2e.js
```

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –æ–±—â–∏–π —Å–∫—Ä–∏–ø—Ç

```bash
./run-all-tests.sh
```

Integration —Ç–µ—Å—Ç—ã –≤–∫–ª—é—á–µ–Ω—ã –≤ –æ–±—â–∏–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### Mock –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

–¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç mock –∫–ª–∏–µ–Ω—Ç—ã –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö API:

- **MockMoySkladClient**: –°–∏–º—É–ª–∏—Ä—É–µ—Ç API –ú–æ–π–°–∫–ª–∞–¥
  - –•—Ä–∞–Ω–∏—Ç —Ç–æ–≤–∞—Ä—ã, –æ—Å—Ç–∞—Ç–∫–∏, –∑–∞–∫–∞–∑—ã
  - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
  
- **MockYandexClient**: –°–∏–º—É–ª–∏—Ä—É–µ—Ç API –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç
  - –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤
  - –•—Ä–∞–Ω–∏—Ç –∑–∞–∫–∞–∑—ã –¥–ª—è polling

### –†–µ–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

–¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

- ProductMappingStore
- OrderMappingStore
- MapperService
- StockService
- OrderService
- MigrationService
- Webhook router

### –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã

–¢–µ—Å—Ç—ã —Å–æ–∑–¥–∞—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏:

- `./data/test-e2e-product-mappings.json`
- `./data/test-e2e-order-mappings.json`
- `./data/test-e2e-migration.json`

–í—Å–µ —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤.

## –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

```
üéâ –í–°–ï INTEGRATION –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û!

–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
  ‚úì End-to-end —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ (product.id ‚Üí offerId ‚Üí M2)
  ‚úì End-to-end –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤ (M2 offerId ‚Üí product.id ‚Üí –ú–æ–π–°–∫–ª–∞–¥)
  ‚úì –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook —Å product.id
  ‚úì –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –≤ —Ñ–∞–π–ª

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É! üöÄ
```

### –ü—Ä–æ–≤–∞–ª —Ç–µ—Å—Ç–∞

–ü—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ —Ç–µ—Å—Ç–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:

```
‚ùå –¢–µ—Å—Ç X –ü–†–û–í–ê–õ–ï–ù: <–æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏>
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏ —Ç–µ—Å—Ç–∞ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–∫–∏
2. –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
3. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å mock –¥–∞–Ω–Ω—ã—Ö

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ integration —Ç–µ—Å—Ç–∞:

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –±–ª–æ–∫ –≤ `test-integration-e2e.js`:

```javascript
// ========================================
// –¢–µ—Å—Ç N: –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞
// ========================================
console.log('\nüîß –¢–µ—Å—Ç N: –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞');
console.log('-'.repeat(60));

try {
  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
  // ...
  
  // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
  // ...
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∏
  // ...
  
  console.log('‚úÖ –¢–µ—Å—Ç N –ü–†–û–ô–î–ï–ù\n');
  testsPassed++;
} catch (error) {
  console.error('‚ùå –¢–µ—Å—Ç N –ü–†–û–í–ê–õ–ï–ù:', error.message);
  testsFailed++;
}
```

2. –û–±–Ω–æ–≤–∏—Ç–µ —Å—á–µ—Ç—á–∏–∫–∏ –∏ –∏—Ç–æ–≥–∏

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

## Best Practices

1. **–ò–∑–æ–ª—è—Ü–∏—è**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º
2. **–û—á–∏—Å—Ç–∫–∞**: –í—Å–µ–≥–¥–∞ —É–¥–∞–ª—è–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
3. **–†–µ–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
4. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –º–æ–∫–∏**: –ú–æ–∫–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–µ API
5. **–î–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**: –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–µ —Ç–æ–ª—å–∫–æ —É—Å–ø–µ—Ö, –Ω–æ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
6. **–ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**: –í—ã–≤–æ–¥–∏—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [Product Mapping Guide](./product-mapping-guide.md)
- [Architecture Data Flow](./architecture-data-flow.md)
- [Stock Service Usage](./stock-service-usage.md)
- [Order Service Usage](./order-service-usage.md)
