# üîí –ê—É–¥–∏—Ç –∏–∑–æ–ª—è—Ü–∏–∏ M1 –∏ M2

## ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ò–∑–æ–ª—è—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 2 –¥–µ–∫–∞–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ë–ï–ó–û–ü–ê–°–ù–û - M1 –∏ M2 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã**

---

## üéØ –ö–ª—é—á–µ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –∏–∑–æ–ª—è—Ü–∏–∏

### –ê—Ç—Ä–∏–±—É—Ç offerId_M2 –≤ –ú–æ–π–°–∫–ª–∞–¥

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```
–ú–æ–π–°–∫–ª–∞–¥ (–æ–¥–Ω–∞ —É—á–µ—Ç–∫–∞, –æ–±—â–∏–µ —Ç–æ–≤–∞—Ä—ã)
‚îú‚îÄ‚îÄ –¢–æ–≤–∞—Ä 1
‚îÇ   ‚îú‚îÄ‚îÄ externalCode: "PROD-001"
‚îÇ   ‚îú‚îÄ‚îÄ name: "–¢–æ–≤–∞—Ä –ê"
‚îÇ   ‚îú‚îÄ‚îÄ –ê—Ç—Ä–∏–±—É—Ç offerId_M1: "M1-SKU-001"  ‚Üê –î–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ M1
‚îÇ   ‚îî‚îÄ‚îÄ –ê—Ç—Ä–∏–±—É—Ç offerId_M2: "M2-SKU-001"  ‚Üê –î–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ M2
‚îÇ
‚îî‚îÄ‚îÄ –¢–æ–≤–∞—Ä 2
    ‚îú‚îÄ‚îÄ externalCode: "PROD-002"
    ‚îú‚îÄ‚îÄ name: "–¢–æ–≤–∞—Ä –ë"
    ‚îú‚îÄ‚îÄ –ê—Ç—Ä–∏–±—É—Ç offerId_M1: "M1-SKU-002"  ‚Üê –î–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ M1
    ‚îî‚îÄ‚îÄ –ê—Ç—Ä–∏–±—É—Ç offerId_M2: "M2-SKU-002"  ‚Üê –î–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ M2
```

**–ò–∑–æ–ª—è—Ü–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è:**
1. Middleware —Ä–∞–±–æ—Ç–∞–µ—Ç **–¢–û–õ–¨–ö–û** —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º `offerId_M2`
2. Middleware **–ù–ï –í–ò–î–ò–¢** –∏ **–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢** –∞—Ç—Ä–∏–±—É—Ç `offerId_M1`
3. –ö–∞–∂–¥—ã–π middleware (M1 –∏ M2) —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–≤–æ–∏–º –∞—Ç—Ä–∏–±—É—Ç–æ–º

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –Ω–∞ –∏–∑–æ–ª—è—Ü–∏—é

### 1. ‚úÖ YandexClient - –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è

**–§–∞–π–ª:** `src/api/yandexClient.js`

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã:**

```javascript
// –°—Ç—Ä–æ–∫–∞ 9-10: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¢–û–õ–¨–ö–û —Å–≤–æ–π Campaign ID
this.campaignId = config.YANDEX_CAMPAIGN_ID;  // ‚Üê –¢–û–õ–¨–ö–û M2!
this.token = config.YANDEX_TOKEN;              // ‚Üê –¢–û–õ–¨–ö–û M2!
```

```javascript
// –°—Ç—Ä–æ–∫–∞ 42-44: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¢–û–õ–¨–ö–û offerId_M2
const requestData = {
  skus: stockUpdates.map(item => ({
    sku: item.offerId_M2,  // ‚Üê –¢–û–õ–¨–ö–û –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–∞ offerId_M2!
    warehouseId: item.warehouseId || 0,
    items: [{
      count: item.count,
      type: 'FIT',
      updatedAt: new Date().toISOString()
    }]
  }))
};
```

```javascript
// –°—Ç—Ä–æ–∫–∞ 56: –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –¢–û–õ–¨–ö–û –∫ M2
`/campaigns/${this.campaignId}/offers/stocks`  // ‚Üê –¢–û–õ–¨–ö–û M2 Campaign!
```

**–í—ã–≤–æ–¥:** ‚úÖ YandexClient —Ä–∞–±–æ—Ç–∞–µ—Ç **–¢–û–õ–¨–ö–û** —Å M2, –∏—Å–ø–æ–ª—å–∑—É—è **–¢–û–õ–¨–ö–û** Campaign ID M2

---

### 2. ‚úÖ MapperService - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¢–û–õ–¨–ö–û offerId_M2

**–§–∞–π–ª:** `src/services/mapperService.js`

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã:**

```javascript
// –°—Ç—Ä–æ–∫–∞ 30-40: –ü–æ–ª—É—á–∞–µ—Ç ID –∞—Ç—Ä–∏–±—É—Ç–∞ offerId_M2
async getOfferIdAttributeId() {
  const attributeId = await this.moySkladClient.getProductAttributes();
  // ‚Üê –ò—â–µ—Ç –¢–û–õ–¨–ö–û –∞—Ç—Ä–∏–±—É—Ç —Å –∏–º–µ–Ω–µ–º "offerId_M2"
  
  if (!attributeId) {
    throw new Error('–ê—Ç—Ä–∏–±—É—Ç offerId_M2 –Ω–µ –Ω–∞–π–¥–µ–Ω');
  }
  
  this.offerIdAttributeId = attributeId;  // ‚Üê –°–æ—Ö—Ä–∞–Ω—è–µ—Ç ID –¢–û–õ–¨–ö–û offerId_M2
}
```

```javascript
// –°—Ç—Ä–æ–∫–∞ 70-85: –ü–∞—Ä—Å–∏—Ç –¢–û–õ–¨–ö–û offerId_M2
const offerIdAttr = product.attributes?.find(
  attr => attr.id === this.offerIdAttributeId  // ‚Üê –ò—â–µ—Ç –¢–û–õ–¨–ö–û –ø–æ ID offerId_M2!
);

const offerId_M2 = offerIdAttr?.value;  // ‚Üê –ë–µ—Ä–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –¢–û–õ–¨–ö–û offerId_M2!

// –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –±–µ–∑ offerId_M2
if (!offerId_M2) {
  skippedCount++;
  continue;  // ‚Üê –¢–æ–≤–∞—Ä—ã –±–µ–∑ offerId_M2 –ò–ì–ù–û–†–ò–†–£–Æ–¢–°–Ø!
}
```

**–í—ã–≤–æ–¥:** ‚úÖ MapperService —Ä–∞–±–æ—Ç–∞–µ—Ç **–¢–û–õ–¨–ö–û** —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º `offerId_M2`, –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç `offerId_M1`

---

### 3. ‚úÖ StockService - –ü–µ—Ä–µ–¥–∞–µ—Ç –¢–û–õ–¨–ö–û offerId_M2

**–§–∞–π–ª:** `src/services/stockService.js`

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã:**

```javascript
// –°—Ç—Ä–æ–∫–∞ 130-135: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è M2
const stockUpdates = [{
  offerId_M2: offerId_M2,  // ‚Üê –¢–û–õ–¨–ö–û offerId_M2!
  count: availableStock,    // ‚Üê –¢–û–õ–¨–ö–û –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ!
  warehouseId: 0
}];

// –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç
await this.yandexClient.updateStocks(stockUpdates);
```

**–ß—Ç–æ –ù–ï –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è:**
- ‚ùå externalCode (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–¥ –ú–æ–π–°–∫–ª–∞–¥)
- ‚ùå name (–Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞)
- ‚ùå price (—Ü–µ–Ω–∞)
- ‚ùå offerId_M1 (–∞—Ç—Ä–∏–±—É—Ç –¥–ª—è M1)
- ‚ùå –õ—é–±—ã–µ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ

**–í—ã–≤–æ–¥:** ‚úÖ StockService –ø–µ—Ä–µ–¥–∞–µ—Ç –≤ M2 **–¢–û–õ–¨–ö–û** offerId_M2 –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

---

### 4. ‚úÖ MoySkladClient - –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ offerId_M2

**–§–∞–π–ª:** `src/api/moySkladClient.js`

–î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º:

<function_calls>
<invoke name="readFile">
<parameter name="path">src/api/moySkladClient.js

###
 4. ‚úÖ MoySkladClient - –ò—â–µ—Ç –¢–û–õ–¨–ö–û offerId_M2

**–§–∞–π–ª:** `src/api/moySkladClient.js`

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã:**

```javascript
// –°—Ç—Ä–æ–∫–∞ 40: –ò—â–µ—Ç –¢–û–õ–¨–ö–û –∞—Ç—Ä–∏–±—É—Ç —Å –∏–º–µ–Ω–µ–º "offerId_M2"
const offerIdAttr = attributes.find(attr => attr.name === 'offerId_M2');
//                                                          ^^^^^^^^^^^^
//                                                          –¢–û–õ–¨–ö–û M2!
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∏–∑ –ú–æ–π–°–∫–ª–∞–¥
2. –ò—â–µ—Ç –∞—Ç—Ä–∏–±—É—Ç —Å **–¢–û–ß–ù–´–ú** –∏–º–µ–Ω–µ–º `offerId_M2`
3. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ ID
4. –ï—Å–ª–∏ –ù–ï –Ω–∞–π–¥–µ–Ω - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç null –∏ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É

**–í—ã–≤–æ–¥:** ‚úÖ MoySkladClient —Ä–∞–±–æ—Ç–∞–µ—Ç **–¢–û–õ–¨–ö–û** —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º `offerId_M2`, –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç `offerId_M1`

---

## üõ°Ô∏è –ú–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω–æ–≥–æ –≤–ª–∏—è–Ω–∏—è

### 1. –†–∞–∑–Ω—ã–µ Campaign ID

```javascript
// M1 Middleware (–¥—Ä—É–≥–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä)
YANDEX_CAMPAIGN_ID=campaign_id_for_M1  // ‚Üê M1

// M2 Middleware (—ç—Ç–æ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä)
YANDEX_CAMPAIGN_ID=campaign_id_for_M2  // ‚Üê M2
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–∞–∂–¥—ã–π middleware —Ä–∞–±–æ—Ç–∞–µ—Ç **–¢–û–õ–¨–ö–û** —Å–æ —Å–≤–æ–∏–º –º–∞–≥–∞–∑–∏–Ω–æ–º

---

### 2. –†–∞–∑–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –≤ –ú–æ–π–°–∫–ª–∞–¥

```javascript
// M1 Middleware –∏—â–µ—Ç:
attr.name === 'offerId_M1'  // ‚Üê –¢–û–õ–¨–ö–û M1

// M2 Middleware –∏—â–µ—Ç:
attr.name === 'offerId_M2'  // ‚Üê –¢–û–õ–¨–ö–û M2
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–∞–∂–¥—ã–π middleware –≤–∏–¥–∏—Ç **–¢–û–õ–¨–ö–û** —Å–≤–æ–π –∞—Ç—Ä–∏–±—É—Ç

---

### 3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–∞–ø–ø–∏–Ω–≥–∞

```javascript
// MapperService –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –±–µ–∑ offerId_M2
if (!offerId_M2) {
  skippedCount++;
  continue;  // ‚Üê –¢–æ–≤–∞—Ä –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è!
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ï—Å–ª–∏ —É —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç `offerId_M2`, –æ–Ω **–ù–ï —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è** —Å M2

---

## üìä –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –¢–æ–≤–∞—Ä —Ç–æ–ª—å–∫–æ –≤ M1

```
–ú–æ–π–°–∫–ª–∞–¥:
  –¢–æ–≤–∞—Ä A
    externalCode: "PROD-001"
    offerId_M1: "M1-SKU-001"  ‚úÖ –ï—Å—Ç—å
    offerId_M2: (–ø—É—Å—Ç–æ)       ‚ùå –ù–µ—Ç

M1 Middleware: ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç (–≤–∏–¥–∏—Ç offerId_M1)
M2 Middleware: ‚ùå –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç (–Ω–µ—Ç offerId_M2)
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –¢–æ–≤–∞—Ä —Ç–æ–ª—å–∫–æ –≤ M2

```
–ú–æ–π–°–∫–ª–∞–¥:
  –¢–æ–≤–∞—Ä B
    externalCode: "PROD-002"
    offerId_M1: (–ø—É—Å—Ç–æ)       ‚ùå –ù–µ—Ç
    offerId_M2: "M2-SKU-002"  ‚úÖ –ï—Å—Ç—å

M1 Middleware: ‚ùå –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç (–Ω–µ—Ç offerId_M1)
M2 Middleware: ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç (–≤–∏–¥–∏—Ç offerId_M2)
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –¢–æ–≤–∞—Ä –≤ –æ–±–æ–∏—Ö –º–∞–≥–∞–∑–∏–Ω–∞—Ö

```
–ú–æ–π–°–∫–ª–∞–¥:
  –¢–æ–≤–∞—Ä C
    externalCode: "PROD-003"
    offerId_M1: "M1-SKU-003"  ‚úÖ –ï—Å—Ç—å
    offerId_M2: "M2-SKU-003"  ‚úÖ –ï—Å—Ç—å

M1 Middleware: ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å M1 (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç offerId_M1)
M2 Middleware: ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å M2 (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç offerId_M2)

–í–ê–ñ–ù–û: –ö–∞–∂–¥—ã–π middleware —Ä–∞–±–æ—Ç–∞–µ—Ç –ù–ï–ó–ê–í–ò–°–ò–ú–û!
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- [x] **YANDEX_CAMPAIGN_ID** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è M2
- [x] **YANDEX_TOKEN** - —Ç–æ–∫–µ–Ω –¥–ª—è M2
- [x] **MS_TOKEN** - –æ–±—â–∏–π —Ç–æ–∫–µ–Ω –ú–æ–π–°–∫–ª–∞–¥ (–æ–¥–Ω–∞ —É—á–µ—Ç–∫–∞)

### –ö–æ–¥

- [x] YandexClient –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¢–û–õ–¨–ö–û Campaign ID M2
- [x] MoySkladClient –∏—â–µ—Ç –¢–û–õ–¨–ö–û –∞—Ç—Ä–∏–±—É—Ç `offerId_M2`
- [x] MapperService —Ä–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û —Å `offerId_M2`
- [x] StockService –ø–µ—Ä–µ–¥–∞–µ—Ç –¢–û–õ–¨–ö–û `offerId_M2` –∏ `count`
- [x] OrderService –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¢–û–õ–¨–ö–û –º–∞–ø–ø–∏–Ω–≥–∏ M2
- [x] –ù–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–π `offerId_M1` –≤ –∫–æ–¥–µ
- [x] –ù–µ—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã—Ö Campaign ID

### –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

- [x] –í M2 –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û `offerId_M2` –∏ `count`
- [x] `externalCode` –ù–ï –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ M2
- [x] –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ù–ï –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ M2
- [x] –¶–µ–Ω–∞ –ù–ï –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ M2
- [x] –ê—Ç—Ä–∏–±—É—Ç `offerId_M1` –ù–ï —á–∏—Ç–∞–µ—Ç—Å—è

---

## üö® –ß—Ç–æ –º–æ–∂–µ—Ç –ø–æ–π—Ç–∏ –Ω–µ —Ç–∞–∫ (–∏ –∫–∞–∫ —ç—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–æ)

### ‚ùå –†–∏—Å–∫ 1: –ü–µ—Ä–µ–ø—É—Ç–∞—Ç—å Campaign ID

**–ß—Ç–æ –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è:** Middleware M2 –æ—Ç–ø—Ä–∞–≤–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ M1

**–ö–∞–∫ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–æ:**
- Campaign ID –±–µ—Ä–µ—Ç—Å—è –∏–∑ `.env` —Ñ–∞–π–ª–∞
- –ö–∞–∂–¥—ã–π middleware –∏–º–µ–µ—Ç —Å–≤–æ–π `.env`
- –ù–µ—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã—Ö ID –≤ –∫–æ–¥–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:**
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Campaign ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π!
grep YANDEX_CAMPAIGN_ID .env
```

---

### ‚ùå –†–∏—Å–∫ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ —Ç–æ—Ç –∞—Ç—Ä–∏–±—É—Ç

**–ß—Ç–æ –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è:** Middleware M2 –ø—Ä–æ—á–∏—Ç–∞–µ—Ç `offerId_M1`

**–ö–∞–∫ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–æ:**
- –ò–º—è –∞—Ç—Ä–∏–±—É—Ç–∞ –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–æ: `'offerId_M2'`
- –ü–æ–∏—Å–∫ –∞—Ç—Ä–∏–±—É—Ç–∞ –ø–æ –¢–û–ß–ù–û–ú–£ –∏–º–µ–Ω–∏
- –ï—Å–ª–∏ –∞—Ç—Ä–∏–±—É—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω - –æ—à–∏–±–∫–∞ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ:**
```javascript
// src/api/moySkladClient.js:40
const offerIdAttr = attributes.find(attr => attr.name === 'offerId_M2');
//                                                          ^^^^^^^^^^^^
//                                                          –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–æ!
```

---

### ‚ùå –†–∏—Å–∫ 3: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã

**–ß—Ç–æ –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è:** –¢–æ–≤–∞—Ä—ã –±–µ–∑ `offerId_M2` –ø–æ–ø–∞–¥—É—Ç –≤ M2

**–ö–∞–∫ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–æ:**
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ MapperService
- –¢–æ–≤–∞—Ä—ã –±–µ–∑ `offerId_M2` –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ:**
```javascript
// src/services/mapperService.js:85
if (!offerId_M2) {
  skippedCount++;
  logger.debug('–¢–æ–≤–∞—Ä –±–µ–∑ offerId_M2 –ø—Ä–æ–ø—É—â–µ–Ω');
  continue;  // ‚Üê –¢–æ–≤–∞—Ä –ù–ï –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –º–∞–ø–ø–∏–Ω–≥!
}
```

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Campaign ID

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ .env –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Campaign ID –¥–ª—è M2!
cat .env | grep YANDEX_CAMPAIGN_ID
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** Campaign ID –º–∞–≥–∞–∑–∏–Ω–∞ M2 (–ù–ï M1!)

---

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—Ç—Ä–∏–±—É—Ç –≤ –ú–æ–π–°–∫–ª–∞–¥

1. –ó–∞–π–¥–∏—Ç–µ –≤ –ú–æ–π–°–∫–ª–∞–¥
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π —Ç–æ–≤–∞—Ä
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –µ—Å—Ç—å –∞—Ç—Ä–∏–±—É—Ç `offerId_M2`
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç SKU –≤ M2

**–ü—Ä–∏–º–µ—Ä:**
```
–¢–æ–≤–∞—Ä: "–¢–æ–≤–∞—Ä –ê"
externalCode: "PROD-001"
offerId_M1: "M1-SKU-001"  ‚Üê –î–ª—è M1 (–ù–ï —Ç—Ä–æ–≥–∞–µ–º!)
offerId_M2: "M2-SKU-001"  ‚Üê –î–ª—è M2 (–∏—Å–ø–æ–ª—å–∑—É–µ–º!)
```

---

### –®–∞–≥ 3: –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ middleware
npm start

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
tail -f logs/combined.log

# 3. –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –º–∞–ø–ø–∏–Ω–≥–æ–≤
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "–ù–∞–π–¥–µ–Ω –∞—Ç—Ä–∏–±—É—Ç offerId_M2 —Å ID: ..."
```

---

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–ª—è—Ü–∏–∏

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–í –ª–æ–≥–∞—Ö middleware M2:**
   ```
   –ù–∞–π–¥–µ–Ω –∞—Ç—Ä–∏–±—É—Ç offerId_M2 —Å ID: ...
   –ó–∞–≥—Ä—É–∂–µ–Ω–æ –º–∞–ø–ø–∏–Ω–≥–æ–≤: X
   ```

2. **–í M2 (–Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç):**
   - –û—Å—Ç–∞—Ç–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ —Å `offerId_M2`
   - –¢–æ–≤–∞—Ä—ã –±–µ–∑ `offerId_M2` –ù–ï –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è

3. **–í M1 (–Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç):**
   - –û—Å—Ç–∞—Ç–∫–∏ –ù–ï –º–µ–Ω—è—é—Ç—Å—è
   - Middleware M2 –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ M1

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

### –ò–∑–æ–ª—è—Ü–∏—è M1 –∏ M2: –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ê

**–ú–µ—Ö–∞–Ω–∏–∑–º—ã –∏–∑–æ–ª—è—Ü–∏–∏:**

1. ‚úÖ **–†–∞–∑–Ω—ã–µ Campaign ID** - –∫–∞–∂–¥—ã–π middleware —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–≤–æ–∏–º –º–∞–≥–∞–∑–∏–Ω–æ–º
2. ‚úÖ **–†–∞–∑–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã** - M1 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `offerId_M1`, M2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `offerId_M2`
3. ‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤** - —Ç–æ–≤–∞—Ä—ã –±–µ–∑ –Ω—É–∂–Ω–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
4. ‚úÖ **–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –≤ –Ø–Ω–¥–µ–∫—Å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û offerId –∏ count
5. ‚úÖ **–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã** - –∫–∞–∂–¥—ã–π middleware —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ

**–ì–∞—Ä–∞–Ω—Ç–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

- ‚ùå M2 Middleware **–ù–ï –í–ò–î–ò–¢** –∞—Ç—Ä–∏–±—É—Ç `offerId_M1`
- ‚ùå M2 Middleware **–ù–ï –ú–û–ñ–ï–¢** –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ M1
- ‚ùå M2 Middleware **–ù–ï –í–õ–ò–Ø–ï–¢** –Ω–∞ —Ç–æ–≤–∞—Ä—ã –±–µ–∑ `offerId_M2`
- ‚úÖ M2 Middleware —Ä–∞–±–æ—Ç–∞–µ—Ç **–¢–û–õ–¨–ö–û** —Å —Ç–æ–≤–∞—Ä–∞–º–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å `offerId_M2`
- ‚úÖ M2 Middleware –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ **–¢–û–õ–¨–ö–û** –≤ Campaign M2

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ production:

1. ‚úÖ **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Campaign ID** - —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —ç—Ç–æ ID –º–∞–≥–∞–∑–∏–Ω–∞ M2
2. ‚úÖ **–°–æ–∑–¥–∞–π—Ç–µ –∞—Ç—Ä–∏–±—É—Ç offerId_M2** –≤ –ú–æ–π–°–∫–ª–∞–¥ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
3. ‚úÖ **–ó–∞–ø–æ–ª–Ω–∏—Ç–µ offerId_M2** –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ M2
4. ‚úÖ **–ù–ï –∑–∞–ø–æ–ª–Ω—è–π—Ç–µ offerId_M2** –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ M2
5. ‚úÖ **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã** - `./run-all-tests.sh`
6. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** - –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

### –í–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:

1. ‚úÖ **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏** - `tail -f logs/combined.log`
2. ‚úÖ **–°–ª–µ–¥–∏—Ç–µ –∑–∞ M1** - —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –æ—Å—Ç–∞—Ç–∫–∏ –ù–ï –º–µ–Ω—è—é—Ç—Å—è
3. ‚úÖ **–°–ª–µ–¥–∏—Ç–µ –∑–∞ M2** - —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –æ—Å—Ç–∞—Ç–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

**–°–¢–ê–¢–£–°: ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û –î–õ–Ø –ó–ê–ü–£–°–ö–ê**

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 2 –¥–µ–∫–∞–±—Ä—è 2024  
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò–∑–æ–ª—è—Ü–∏—è M1 –∏ M2 –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–µ—Å–ø–µ—á–µ–Ω–∞

---

*–≠—Ç–æ—Ç –∞—É–¥–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —á—Ç–æ M2 Middleware —Ä–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û —Å –º–∞–≥–∞–∑–∏–Ω–æ–º M2 –∏ –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ –º–∞–≥–∞–∑–∏–Ω M1.*
