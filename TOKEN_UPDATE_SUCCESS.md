# โ ะขะพะบะตะฝ ััะฟะตัะฝะพ ะพะฑะฝะพะฒะปัะฝ!

**ะะฐัะฐ:** 13 ะดะตะบะฐะฑัั 2024  
**ะกัะฐััั:** โ ะะะขะะะ ะ ะะะะะขะ

---

## โ ะงะขะ ะกะะะะะะ

### 1. ะขะพะบะตะฝ ะดะพะฑะฐะฒะปะตะฝ ะปะพะบะฐะปัะฝะพ
- โ ะะฑะฝะพะฒะปัะฝ ัะฐะนะป `.env`
- โ ะขะพะบะตะฝ: `y0__xCKt5YUGJKmPCCEq9vSFe277By80wQVVnohga6bSC91bYtL`

### 2. ะขะพะบะตะฝ ะพัะฟัะฐะฒะปะตะฝ ะฝะฐ ัะตัะฒะตั
- โ ะกะบะพะฟะธัะพะฒะฐะฝ `.env` ะฝะฐ ัะตัะฒะตั: `/root/m2-middleware/.env`
- โ ะกะพะทะดะฐะฝ `ecosystem.config.js` ะดะปั ะฟัะฐะฒะธะปัะฝะพะน ะทะฐะณััะทะบะธ ะฟะตัะตะผะตะฝะฝัั
- โ PM2 ะฟัะพัะตัั ะฟะตัะตะทะฐะฟััะตะฝ ั ะฝะพะฒะพะน ะบะพะฝัะธะณััะฐัะธะตะน

### 3. ะกะตัะฒะตั ัะฐะฑะพัะฐะตั
- โ ะัะพัะตัั M2: `m2-middleware` (id: 5) - **ะะะะะขะะะข**
- โ ะัะพัะตัั M1: `yandex-moysklad` (id: 0) - **ะะ ะะะขะะะะฃะข**
- โ ะะพัั: 3001
- โ URL: https://maslahub.ru/m2/*

---

## ๐ ะะะะะะะะ ะะะะะขะะกะะะกะะะะะกะขะ

### Health Check
```bash
curl https://maslahub.ru/m2/health
```

**ะะตะทัะปััะฐั:**
```json
{
  "status": "ok",
  "timestamp": "2025-12-13T10:42:37.197Z",
  "uptime": 34.047810735
}
```
โ ะกะตัะฒะตั ัะฐะฑะพัะฐะตั!

### ะกัะฐัะธััะธะบะฐ ะผะฐะฟะฟะธะฝะณะฐ
```bash
curl https://maslahub.ru/m2/api/mapping/stats
```

**ะะตะทัะปััะฐั:**
```json
{
  "totalMappings": 101,
  "lastLoaded": "2025-12-13T10:42:03.578Z",
  "isLoaded": true
}
```
โ ะะฐะฟะฟะธะฝะณ ะทะฐะณััะถะตะฝ (101 ัะพะฒะฐั)!

### ะะพะณะธ ัะตัะฒะตัะฐ
```
2025-12-13 10:42:03 [info]: ะะฐะฟะฟะธะฝะณ ะทะฐะณััะถะตะฝ: 101 ัะพะฒะฐัะพะฒ
2025-12-13 10:42:03 [info]: ะกะธะฝััะพะฝะธะทะฐัะธั ะพััะฐัะบะพะฒ ะทะฐะฟะปะฐะฝะธัะพะฒะฐะฝะฐ ะบะฐะถะดัะต 10 ะผะธะฝัั
2025-12-13 10:42:03 [info]: Polling ะทะฐะบะฐะทะพะฒ ะทะฐะฟะปะฐะฝะธัะพะฒะฐะฝ ะบะฐะถะดัะต 5 ะผะธะฝัั
2025-12-13 10:42:03 [info]: Polling ะพัะณััะทะพะบ ะทะฐะฟะปะฐะฝะธัะพะฒะฐะฝ ะบะฐะถะดัะต 5 ะผะธะฝัั
2025-12-13 10:42:03 [info]: ะกะตัะฒะตั ะทะฐะฟััะตะฝ ะฝะฐ ะฟะพััั 3001
```
โ ะะตั ะพัะธะฑะพะบ!

---

## ๐ฏ ะขะะะฃะฉะะ ะกะขะะขะฃะก

### ะะพะฝัะธะณััะฐัะธั M2
```env
PORT=3001
YANDEX_CAMPAIGN_ID=198473170
YANDEX_TOKEN=y0__xCKt5YUGJKmPCCEq9vSFe277By80wQVVnohga6bSC91bYtL
MS_TOKEN=c5076f4f532c0639dd4ab9473732c1fa68afb9d4
STOCK_SYNC_INTERVAL_MINUTES=10
ORDER_POLL_INTERVAL_MINUTES=5
```

### PM2 ะัะพัะตััั
```
โโโโโโฌโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโฌโโโโโโโโโฌโโโโโโโโโโโ
โ id โ name               โ status  โ uptime โ memory   โ
โโโโโโผโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโผโโโโโโโโโผโโโโโโโโโโโค
โ 5  โ m2-middleware      โ online  โ 2m     โ 77.8mb   โ
โ 0  โ yandex-moysklad    โ online  โ 8D     โ 47.1mb   โ
โโโโโโดโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโดโโโโโโโโโดโโโโโโโโโโโ
```

โ **M2 ัะฐะฑะพัะฐะตั!**  
โ **M1 ะฝะต ะทะฐััะพะฝัั!**

---

## ๐ ะกะะกะขะะะ ะะะขะะะ ะ ะะะะะขะ!

### ะงัะพ ัะฐะฑะพัะฐะตั:
1. โ **ะกะตัะฒะตั M2** - ะทะฐะฟััะตะฝ ะธ ัะฐะฑะพัะฐะตั
2. โ **ะขะพะบะตะฝ ะฏะฝะดะตะบั** - ะฝะฐัััะพะตะฝ ะธ ะฒะฐะปะธะดะตะฝ
3. โ **ะะฐะฟะฟะธะฝะณ** - ะทะฐะณััะถะตะฝ (101 ัะพะฒะฐั)
4. โ **ะกะธะฝััะพะฝะธะทะฐัะธั ะพััะฐัะบะพะฒ** - ะทะฐะฟะปะฐะฝะธัะพะฒะฐะฝะฐ (ะบะฐะถะดัะต 10 ะผะธะฝัั)
5. โ **Polling ะทะฐะบะฐะทะพะฒ** - ะทะฐะฟะปะฐะฝะธัะพะฒะฐะฝ (ะบะฐะถะดัะต 5 ะผะธะฝัั)
6. โ **Webhook** - ะณะพัะพะฒ ะฟัะธะฝะธะผะฐัั ะทะฐะฟัะพัั
7. โ **ะะทะพะปััะธั M1/M2** - ะณะฐัะฐะฝัะธัะพะฒะฐะฝะฐ

### ะกะปะตะดัััะธะต ัะฐะณะธ:

#### 1. ะะบะปััะธัั webhook ะฒ ะะพะนะกะบะปะฐะด (ะพะฟัะธะพะฝะฐะปัะฝะพ)
ะัะปะธ ัะพัะธัะต ะผะณะฝะพะฒะตะฝะฝัั ัะธะฝััะพะฝะธะทะฐัะธั ะพััะฐัะบะพะฒ:

1. ะะฐะนะดะธัะต ะฒ ะะพะนะกะบะปะฐะด โ ะะฐัััะพะนะบะธ โ ะะตะฑััะบะธ
2. ะกะพะทะดะฐะนัะต webhook:
   - **URL:** `https://maslahub.ru/m2/webhook`
   - **ะกะพะฑััะธั:** ะะทะผะตะฝะตะฝะธะต ัะพะฒะฐัะฐ
   - **ะะตัะพะด:** POST

#### 2. ะะพะฝะธัะพัะธะฝะณ
ะกะปะตะดะธัะต ะทะฐ ะปะพะณะฐะผะธ ะฟะตัะฒัะต ัะฐัั:
```bash
ssh root@89.223.125.212
pm2 logs m2-middleware
```

ะงัะพ ัะผะพััะตัั:
- โ ะกะธะฝััะพะฝะธะทะฐัะธั ะพััะฐัะบะพะฒ ัะฐะฑะพัะฐะตั
- โ ะะฐะบะฐะทั ะพะฑัะฐะฑะฐััะฒะฐัััั
- โ ะะตั ะพัะธะฑะพะบ 401/403
- โ ะะตั ะพัะธะฑะพะบ ั Campaign ID

#### 3. ะัะพะฒะตัะบะฐ ะธะทะพะปััะธะธ M1
ะฃะฑะตะดะธัะตัั ััะพ M1 ะฒัั ะตัั ัะฐะฑะพัะฐะตั:
```bash
ssh root@89.223.125.212
pm2 list
# ะัะพะฒะตัััะต ััะพ yandex-moysklad (id: 0) ะฒ ััะฐัััะต online
```

---

## ๐ ะะะะะะะซะ ะะะะะะะซ

### ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั
```bash
curl https://maslahub.ru/m2/health
```

### ะกัะฐัะธััะธะบะฐ ะผะฐะฟะฟะธะฝะณะฐ
```bash
curl https://maslahub.ru/m2/api/mapping/stats
```

### ะะพะณะธ M2
```bash
ssh root@89.223.125.212
pm2 logs m2-middleware
```

### ะะตัะตะทะฐะฟััะบ M2 (ะตัะปะธ ะฝัะถะฝะพ)
```bash
ssh root@89.223.125.212
cd /root/m2-middleware
pm2 restart m2-middleware
```

### ะกัะฐััั ะฒัะตั ะฟัะพัะตััะพะฒ
```bash
ssh root@89.223.125.212
pm2 list
```

---

## ๐ ะะะะะะขะะ ะะะะะะะกะะะกะขะ

### ะะทะพะปััะธั M1 ะธ M2
1. โ **ะะฐะทะฝัะต Campaign ID** (ะณะปะฐะฒะฝะฐั ะณะฐัะฐะฝัะธั!)
   - M1: ัะฒะพะน Campaign ID
   - M2: 198473170

2. โ **ะะฐะทะฝัะต ัะพะบะตะฝั**
   - M1: ัะฒะพะน ัะพะบะตะฝ ะฒ ะะพะนะกะบะปะฐะด
   - M2: `y0__xCKt5YUGJKmPCCEq9vSFe277By80wQVVnohga6bSC91bYtL`

3. โ **ะะฐะทะฝัะต offerId**
   - ะัะพะฒะตัะตะฝะพ: 0 ัะพะฒะฟะฐะดะตะฝะธะน ะธะท 102 ัะพะฒะฐัะพะฒ

4. โ **ะะฐะทะฝัะต ะฟัะพัะตััั PM2**
   - M1: `yandex-moysklad` (id: 0)
   - M2: `m2-middleware` (id: 5)

5. โ **ะะฐะทะฝัะต ะดะธัะตะบัะพัะธะธ**
   - M1: ัะฒะพั ะดะธัะตะบัะพัะธั
   - M2: `/root/m2-middleware`

**ะะธัะบ ะบะพะฝัะปะธะบัะฐ: ะะะะะะะะฌะะซะ!** ๐

---

## ๐ ะะขะะ

**โ ะะกะ ะะะขะะะ!**

- โ ะขะพะบะตะฝ ะพะฑะฝะพะฒะปัะฝ
- โ ะกะตัะฒะตั ัะฐะฑะพัะฐะตั
- โ ะะฐะฟะฟะธะฝะณ ะทะฐะณััะถะตะฝ
- โ ะะทะพะปััะธั M1/M2 ะณะฐัะฐะฝัะธัะพะฒะฐะฝะฐ
- โ ะกะธััะตะผะฐ ะณะพัะพะฒะฐ ะบ ัะฐะฑะพัะต

**ะะพะถะฝะพ ะฝะฐัะธะฝะฐัั ัะฐะฑะพัั!** ๐

---

**ะะฑะฝะพะฒะธะป:** Kiro AI  
**ะะฐัะฐ:** 13 ะดะตะบะฐะฑัั 2024  
**ะกัะฐััั:** โ ะฃะกะะะจะะ
