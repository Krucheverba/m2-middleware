#!/bin/bash

# Скрипт для проверки статуса синхронизации

SERVER="root@89.223.125.212"
PROJECT_DIR="/root/m2-middleware"

echo "🔍 Проверка статуса синхронизации остатков..."
echo ""

echo "═══════════════════════════════════════════════════════════"
echo "📊 ПОСЛЕДНЯЯ СИНХРОНИЗАЦИЯ"
echo "═══════════════════════════════════════════════════════════"
ssh $SERVER "tail -500 $PROJECT_DIR/logs/combined.log | grep 'Синхронизация остатков завершена' | tail -1"

echo ""
echo "═══════════════════════════════════════════════════════════"
echo "❌ ПОСЛЕДНИЕ ОШИБКИ (если есть)"
echo "═══════════════════════════════════════════════════════════"
ssh $SERVER "tail -200 $PROJECT_DIR/logs/combined.log | grep -i 'error.*1014' | tail -5"

echo ""
echo "═══════════════════════════════════════════════════════════"
echo "✅ УСПЕШНЫЕ СИНХРОНИЗАЦИИ (последние 3)"
echo "═══════════════════════════════════════════════════════════"
ssh $SERVER "tail -500 $PROJECT_DIR/logs/combined.log | grep 'synced' | tail -3"

echo ""
echo "💡 Синхронизация происходит каждые 10 минут"
echo "   Следующая синхронизация в: XX:X0, XX:X0, XX:X0..."
