# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook —Å–æ–±—ã—Ç–∏–π –∑–∞–∫–∞–∑–æ–≤ –æ—Ç –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –û–±–Ω–æ–≤–ª—ë–Ω —Ñ–∞–π–ª `src/routes/moySkladWebhook.js`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhook —Å–æ–±—ã—Ç–∏–π –æ—Ç –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç:

- **POST /webhook** - –æ—Å–Ω–æ–≤–Ω–æ–π endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –∑–∞–∫–∞–∑–æ–≤
- **POST /webhook/notification** - endpoint –¥–ª—è PING –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç
- **GET /webhook** –∏ **GET /webhook/notification** - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

### 2. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π

#### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è:

1. **ORDER_CREATED** - –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω
   - –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ API
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å PROCESSING)
   - –°–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑ –≤ –ú–æ–π–°–∫–ª–∞–¥ —á–µ—Ä–µ–∑ OrderService
   - –ú–∞–ø–ø–∏—Ä—É–µ—Ç offerId ‚Üí product.id –¥–ª—è –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π
   - –†–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ –ú–æ–π–°–∫–ª–∞–¥

2. **ORDER_STATUS_UPDATED** - —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –∏–∑–º–µ–Ω–∏–ª—Å—è
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
   - –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å SHIPPED –∏–ª–∏ DELIVERED - —Å–æ–∑–¥–∞—ë—Ç –æ—Ç–≥—Ä—É–∑–∫—É –≤ –ú–æ–π–°–∫–ª–∞–¥
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ M2 Order ID ‚Üí –ú–æ–π–°–∫–ª–∞–¥ Order ID

3. **ORDER_CANCELLED** - –∑–∞–∫–∞–∑ –æ—Ç–º–µ–Ω—ë–Ω
   - –ù–∞—Ö–æ–¥–∏—Ç –º–∞–ø–ø–∏–Ω–≥ M2 Order ID ‚Üí –ú–æ–π–°–∫–ª–∞–¥ Order ID
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –∑–∞–∫–∞–∑ –µ—â—ë –Ω–µ –æ—Ç–≥—Ä—É–∂–µ–Ω (–Ω–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ—Ç–≥—Ä—É–∑–æ–∫)
   - –£–¥–∞–ª—è–µ—Ç –∑–∞–∫–∞–∑ –∏–∑ –ú–æ–π–°–∫–ª–∞–¥ (—Å–Ω–∏–º–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤)
   - –£–¥–∞–ª—è–µ—Ç –º–∞–ø–ø–∏–Ω–≥ –∑–∞–∫–∞–∑–∞
   - –ï—Å–ª–∏ –∑–∞–∫–∞–∑ —É–∂–µ –æ—Ç–≥—Ä—É–∂–µ–Ω - –ª–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)

### 3. –û–±–Ω–æ–≤–ª—ë–Ω —Ñ–∞–π–ª `src/server.js`

- –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è `orderService` –≤ webhook —Ä–æ—É—Ç–µ—Ä
- Webhook —Ä–æ—É—Ç–µ—Ä —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ OrderService –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞:

1. –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `https://mirmasla.online/m2/webhook`
2. Webhook endpoint –±—ã—Å—Ç—Ä–æ –æ—Ç–≤–µ—á–∞–µ—Ç 200 OK (—á—Ç–æ–±—ã –Ø–Ω–¥–µ–∫—Å –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–ª –∑–∞–ø—Ä–æ—Å)
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ:
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è –∏ ID –∑–∞–∫–∞–∑–∞
   - –î–ª—è ORDER_CREATED: –ø–æ–ª—É—á–∞—é—Ç—Å—è –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ API
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `orderService.createMoySkladOrder(order)`
   - OrderService –º–∞–ø–ø–∏—Ä—É–µ—Ç offerId ‚Üí product.id –¥–ª—è –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π
   - –°–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–∫–∞–∑ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –≤ –ú–æ–π–°–∫–ª–∞–¥ —Å —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ–º
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–∞–ø–ø–∏–Ω–≥ M2 Order ID ‚Üí –ú–æ–π–°–∫–ª–∞–¥ Order ID

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≥—Ä—É–∑–∫–∏:

1. –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å —Å —Å–æ–±—ã—Ç–∏–µ–º ORDER_STATUS_UPDATED
2. Webhook endpoint –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
3. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å SHIPPED –∏–ª–∏ DELIVERED:
   - –ù–∞—Ö–æ–¥–∏—Ç—Å—è –º–∞–ø–ø–∏–Ω–≥ M2 Order ID ‚Üí –ú–æ–π–°–∫–ª–∞–¥ Order ID
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `orderService.createShipment(orderId)`
   - –°–æ–∑–¥–∞—ë—Ç—Å—è –æ—Ç–≥—Ä—É–∑–∫–∞ –≤ –ú–æ–π–°–∫–ª–∞–¥
   - –ó–∞–∫–∞–∑ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞:

1. –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å —Å —Å–æ–±—ã—Ç–∏–µ–º ORDER_CANCELLED
2. Webhook endpoint –≤—ã–∑—ã–≤–∞–µ—Ç `orderService.cancelOrder(orderId)`
3. OrderService:
   - –ù–∞—Ö–æ–¥–∏—Ç –º–∞–ø–ø–∏–Ω–≥ M2 Order ID ‚Üí –ú–æ–π–°–∫–ª–∞–¥ Order ID
   - –ü–æ–ª—É—á–∞–µ—Ç –∑–∞–∫–∞–∑ –∏–∑ –ú–æ–π–°–∫–ª–∞–¥
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –∑–∞–∫–∞–∑ –µ—â—ë –Ω–µ –æ—Ç–≥—Ä—É–∂–µ–Ω (–Ω–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ—Ç–≥—Ä—É–∑–æ–∫)
   - –ï—Å–ª–∏ –Ω–µ –æ—Ç–≥—Ä—É–∂–µ–Ω:
     - –£–¥–∞–ª—è–µ—Ç –∑–∞–∫–∞–∑ –∏–∑ –ú–æ–π–°–∫–ª–∞–¥ (—Å–Ω–∏–º–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ)
     - –£–¥–∞–ª—è–µ—Ç –º–∞–ø–ø–∏–Ω–≥ –∑–∞–∫–∞–∑–∞
   - –ï—Å–ª–∏ —É–∂–µ –æ—Ç–≥—Ä—É–∂–µ–Ω:
     - –õ–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
     - –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞

## –ò–∑–æ–ª—è—Ü–∏—è –æ—à–∏–±–æ–∫

- –í—Å–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç —Ä–∞–±–æ—Ç—É
- Webhook –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ—Ç 200 OK, –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –ï—Å–ª–∏ webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å - –∑–∞–∫–∞–∑ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω —á–µ—Ä–µ–∑ polling
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –æ—à–∏–±–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Å–æ–±—ã—Ç–∏—è webhook –ø–æ–¥—Ä–æ–±–Ω–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
- –¢–∏–ø —Å–æ–±—ã—Ç–∏—è
- ID –∑–∞–∫–∞–∑–∞
- –î–∞–Ω–Ω—ã–µ webhook
- –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –û—à–∏–±–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)

## –§–∞–π–ª—ã –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
# 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
scp src/routes/moySkladWebhook.js root@89.223.125.212:/root/m2-middleware/src/routes/
scp src/server.js root@89.223.125.212:/root/m2-middleware/src/
scp src/services/orderService.js root@89.223.125.212:/root/m2-middleware/src/services/
scp src/services/mapperService.js root@89.223.125.212:/root/m2-middleware/src/services/
scp src/storage/orderMappingStore.js root@89.223.125.212:/root/m2-middleware/src/storage/
scp src/api/moySkladClient.js root@89.223.125.212:/root/m2-middleware/src/api/

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
ssh root@89.223.125.212 "cd /root/m2-middleware && pm2 restart m2-middleware"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
ssh root@89.223.125.212 "pm2 logs m2-middleware --lines 50"
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ webhook —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
ssh root@89.223.125.212 "pm2 logs m2-middleware --lines 0"
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞

1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ –≤ –º–∞–≥–∞–∑–∏–Ω–µ M2 –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç
2. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
   - "–ü–æ–ª—É—á–µ–Ω POST –∑–∞–ø—Ä–æ—Å –æ—Ç –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç"
   - "–û–±—Ä–∞–±–æ—Ç–∫–∞ webhook —Å–æ–±—ã—Ç–∏—è –æ—Ç –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç"
   - "–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ ORDER_CREATED"
   - "–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –ú–æ–π–°–∫–ª–∞–¥"
   - "–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –≤ –ú–æ–π–°–∫–ª–∞–¥ —á–µ—Ä–µ–∑ webhook"

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ú–æ–π–°–∫–ª–∞–¥

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ú–æ–π–°–∫–ª–∞–¥ ‚Üí –ü—Ä–æ–¥–∞–∂–∏ ‚Üí –ó–∞–∫–∞–∑—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π
2. –ù–∞–π–¥–∏—Ç–µ –∑–∞–∫–∞–∑ —Å –∏–º–µ–Ω–µ–º `M2-{orderId}`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ:
   - –í—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –º–∞–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - –¢–æ–≤–∞—Ä—ã –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω—ã
   - –¶–µ–Ω—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≥—Ä—É–∑–∫–∏

1. –û—Ç–º–µ—Ç—å—Ç–µ –∑–∞–∫–∞–∑ –∫–∞–∫ –æ—Ç–≥—Ä—É–∂–µ–Ω–Ω—ã–π –≤ –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç
2. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
   - "–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ ORDER_STATUS_UPDATED"
   - "–ó–∞–∫–∞–∑ –æ—Ç–≥—Ä—É–∂–µ–Ω, —Å–æ–∑–¥–∞—ë–º –æ—Ç–≥—Ä—É–∑–∫—É –≤ –ú–æ–π–°–∫–ª–∞–¥"
   - "–û—Ç–≥—Ä—É–∑–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞ –≤ –ú–æ–π–°–∫–ª–∞–¥ —á–µ—Ä–µ–∑ webhook"

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ú–æ–π–°–∫–ª–∞–¥:
   - –°–æ–∑–¥–∞–Ω–∞ –æ—Ç–≥—Ä—É–∑–∫–∞ –¥–ª—è –∑–∞–∫–∞–∑–∞
   - –ó–∞–∫–∞–∑ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –∑–∞–∫—Ä—ã—Ç
   - –û—Å—Ç–∞—Ç–∫–∏ —É–º–µ–Ω—å—à–µ–Ω—ã

## –†–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º (Polling)

–î–∞–∂–µ –µ—Å–ª–∏ webhook –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ polling:
- –ö–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ .env) –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è polling –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- –ö–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è polling –æ—Ç–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- Polling –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ –∂–µ –∑–∞–∫–∞–∑—ã —á—Ç–æ –∏ webhook
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫—ç—à –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –º–∞–ø–ø–∏–Ω–≥–∞:

```bash
curl https://mirmasla.online/m2/api/mapping/stats
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞:

```bash
curl https://mirmasla.online/m2/health
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
ssh root@89.223.125.212 "pm2 logs m2-middleware --lines 100"

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
ssh root@89.223.125.212 "tail -100 /root/.pm2/logs/m2-middleware-error.log"

# –¢–æ–ª—å–∫–æ –≤—ã–≤–æ–¥
ssh root@89.223.125.212 "tail -100 /root/.pm2/logs/m2-middleware-out.log"
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ Webhook –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç
2. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –∑–∞–∫–∞–∑–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
3. üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–∫–∞–∑–∞—Ö
4. üîÑ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç—ã –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
5. üîÑ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- **M1 vs M2 –∏–∑–æ–ª—è—Ü–∏—è**: Webhook M2 —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø—É—Ç–∏ `/m2/webhook`, –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å M1 (`/webhook`)
- **–ú–∞–ø–ø–∏–Ω–≥–∏**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∞–π–ª `data/product-mappings.json` —Å 101 –º–∞–ø–ø–∏–Ω–≥–æ–º
- **Campaign ID**: M2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Campaign ID 198473170
- **–ü–æ—Ä—Ç**: M2 middleware —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 3001
- **Nginx**: –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç `/m2/*` –Ω–∞ `http://localhost:3001`
