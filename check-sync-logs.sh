#!/bin/bash

# Скрипт проверки логов синхронизации остатков

SERVER="root@89.223.125.212"
PROJECT_DIR="/root/m2-middleware"

echo "🔍 Проверка логов синхронизации остатков..."
echo ""

echo "═══════════════════════════════════════════════════════════"
echo "1. ПОСЛЕДНИЕ ЛОГИ PM2 (последние 50 строк)"
echo "═══════════════════════════════════════════════════════════"
ssh $SERVER "cd $PROJECT_DIR && pm2 logs m2-middleware --lines 50 --nostream"
echo ""

echo "═══════════════════════════════════════════════════════════"
echo "2. ЛОГИ СИНХРОНИЗАЦИИ (grep 'sync')"
echo "═══════════════════════════════════════════════════════════"
ssh $SERVER "cd $PROJECT_DIR && tail -200 logs/combined.log | grep -i sync"
echo ""

echo "═══════════════════════════════════════════════════════════"
echo "3. ОШИБКИ В ЛОГАХ (grep 'error')"
echo "═══════════════════════════════════════════════════════════"
ssh $SERVER "cd $PROJECT_DIR && tail -200 logs/combined.log | grep -i error"
echo ""

echo "═══════════════════════════════════════════════════════════"
echo "4. СТАТУС PM2 ПРОЦЕССА"
echo "═══════════════════════════════════════════════════════════"
ssh $SERVER "pm2 info m2-middleware"
echo ""

echo "✅ Проверка завершена!"
