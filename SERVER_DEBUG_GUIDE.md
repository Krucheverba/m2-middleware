# ðŸ” Ð ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ð¿Ð¾ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ

## ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾, Ð½Ð¾ Ð»Ð¾Ð³Ð¸ Ð¿ÑƒÑÑ‚Ñ‹Ðµ

### Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ñ‹:
1. âŒ ÐŸÐ°Ð¿ÐºÐ° `logs/` Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ
2. âŒ ÐÐµÑ‚ Ð¿Ñ€Ð°Ð² Ð½Ð° Ð·Ð°Ð¿Ð¸ÑÑŒ Ð² Ð¿Ð°Ð¿ÐºÑƒ `logs/`
3. âŒ ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð´Ð¾ Ñ‚Ð¾Ð³Ð¾ ÐºÐ°Ðº ÑƒÑÐ¿ÐµÐ²Ð°ÐµÑ‚ Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð»Ð¾Ð³Ð¸
4. âŒ ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ (node_modules)

---

## ðŸ› ï¸ Ð ÐµÑˆÐµÐ½Ð¸Ðµ: ÐŸÐ¾ÑˆÐ°Ð³Ð¾Ð²Ð°Ñ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°

### Ð¨Ð°Ð³ 1: Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸ ÑÐºÑ€Ð¸Ð¿Ñ‚Ñ‹ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€

```bash
# ÐÐ° Ñ‚Ð²Ð¾Ñ‘Ð¼ ÐºÐ¾Ð¼Ð¿ÑŒÑŽÑ‚ÐµÑ€Ðµ:
scp scripts/test-server-startup.js root@89.223.125.212:/root/m2-middleware/scripts/
scp scripts/setup-logs-folder.js root@89.223.125.212:/root/m2-middleware/scripts/
```

### Ð¨Ð°Ð³ 2: ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸ÑÑŒ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ

```bash
ssh root@89.223.125.212
cd /root/m2-middleware
```

### Ð¨Ð°Ð³ 3: Ð¡Ð¾Ð·Ð´Ð°Ð¹ Ð¿Ð°Ð¿ÐºÑƒ logs

```bash
node scripts/setup-logs-folder.js
```

Ð­Ñ‚Ð¾ ÑÐ¾Ð·Ð´Ð°ÑÑ‚ Ð¿Ð°Ð¿ÐºÑƒ `logs/` ÐµÑÐ»Ð¸ ÐµÑ‘ Ð½ÐµÑ‚.

### Ð¨Ð°Ð³ 4: Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÑƒ

```bash
node scripts/test-server-startup.js
```

Ð­Ñ‚Ð¾Ñ‚ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚:
- âœ… Ð’ÐµÑ€ÑÐ¸ÑŽ Node.js
- âœ… ÐÐ°Ð»Ð¸Ñ‡Ð¸Ðµ .env Ñ„Ð°Ð¹Ð»Ð°
- âœ… ÐÐ°Ð»Ð¸Ñ‡Ð¸Ðµ Ð¿Ð°Ð¿ÐºÐ¸ logs
- âœ… ÐÐ°Ð»Ð¸Ñ‡Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° Ð¼Ð°Ð¿Ð¿Ð¸Ð½Ð³Ð¾Ð²
- âœ… Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
- âœ… Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
- âœ… Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ logger
- âœ… Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ server Ð¼Ð¾Ð´ÑƒÐ»Ñ

### Ð¨Ð°Ð³ 5: Ð•ÑÐ»Ð¸ Ð²ÑÑ‘ ÐžÐš - Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸ PM2

```bash
pm2 delete m2-middleware
pm2 start src/server.js --name m2-middleware
pm2 logs m2-middleware
```

Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð»Ð¾Ð³Ð¸ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑŒÑÑ!

### Ð¨Ð°Ð³ 6: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ Ñ‡Ñ‚Ð¾ ÑÐµÑ€Ð²ÐµÑ€ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ health endpoint
curl http://localhost:3001/health

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ Ð¼Ð°Ð¿Ð¿Ð¸Ð½Ð³Ð¾Ð²
curl http://localhost:3001/api/mapping/stats
```

### Ð¨Ð°Ð³ 7: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ Ñ‡ÐµÑ€ÐµÐ· Nginx

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ Ñ‡ÐµÑ€ÐµÐ· Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ URL
curl https://mirmasla.online/m2/health
curl https://mirmasla.online/m2/api/mapping/stats
```

---

## ðŸš¨ Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð¾ÑÑ‚Ð°Ñ‘Ñ‚ÑÑ

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð: Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ (Ð½Ðµ Ñ‡ÐµÑ€ÐµÐ· PM2)

```bash
cd /root/m2-middleware
node src/server.js
```

Ð­Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð¶ÐµÑ‚ Ð²ÑÐµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð¿Ñ€ÑÐ¼Ð¾ Ð² ÐºÐ¾Ð½ÑÐ¾Ð»Ð¸. ÐÐ°Ð¶Ð¼Ð¸ `Ctrl+C` Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ.

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð‘: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ Ð»Ð¾Ð³Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ Ð»Ð¾Ð³Ð¸ Ð² Ð¿Ð°Ð¿ÐºÐµ logs/
ls -la /root/m2-middleware/logs/
cat /root/m2-middleware/logs/combined.log
cat /root/m2-middleware/logs/error.log
```

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð’: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ PM2 Ð»Ð¾Ð³Ð¸

```bash
pm2 logs m2-middleware --lines 100
```

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð“: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ñ€Ñ‚ ÑÐ»ÑƒÑˆÐ°ÐµÑ‚ÑÑ

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ ÑÐ»ÑƒÑˆÐ°ÐµÑ‚ Ð¿Ð¾Ñ€Ñ‚ 3001
netstat -tlnp | grep 3001
# Ð¸Ð»Ð¸
ss -tlnp | grep 3001
```

Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð²Ñ€Ð¾Ð´Ðµ:
```
tcp  0  0  0.0.0.0:3001  0.0.0.0:*  LISTEN  12345/node
```

---

## âœ… ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº

- [ ] ÐŸÐ°Ð¿ÐºÐ° `logs/` ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
- [ ] Ð¤Ð°Ð¹Ð» `.env` ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ `PORT=3001`
- [ ] Ð¤Ð°Ð¹Ð» `data/product-mappings.json` ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ (101 Ð¼Ð°Ð¿Ð¿Ð¸Ð½Ð³)
- [ ] ÐŸÐ°Ð¿ÐºÐ° `node_modules` ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
- [ ] PM2 Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ ÑÑ‚Ð°Ñ‚ÑƒÑ `online`
- [ ] ÐŸÐ¾Ñ€Ñ‚ 3001 ÑÐ»ÑƒÑˆÐ°ÐµÑ‚ÑÑ
- [ ] `curl http://localhost:3001/health` Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ JSON
- [ ] `curl https://mirmasla.online/m2/health` Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ JSON (Ñ‡ÐµÑ€ÐµÐ· Nginx)

---

## ðŸ“ž Ð§Ñ‚Ð¾ ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ñ‚ÑŒ ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð° Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒ

Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹ Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ ÑÑ‚Ð¸Ñ… ÐºÐ¾Ð¼Ð°Ð½Ð´:

```bash
# 1. Ð’ÐµÑ€ÑÐ¸Ñ Node.js
node --version

# 2. Ð¡Ñ‚Ð°Ñ‚ÑƒÑ PM2
pm2 list

# 3. Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸
node scripts/test-server-startup.js

# 4. ÐŸÐ¾Ð¿Ñ‹Ñ‚ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ (Ð¿ÐµÑ€Ð²Ñ‹Ðµ 20 ÑÑ‚Ñ€Ð¾Ðº Ð²Ñ‹Ð²Ð¾Ð´Ð°)
timeout 5 node src/server.js 2>&1 | head -20

# 5. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ñ€Ñ‚Ð°
netstat -tlnp | grep 3001

# 6. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° health endpoint
curl http://localhost:3001/health
```
