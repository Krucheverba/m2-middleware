# üîí –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢: –ò–∑–æ–ª—è—Ü–∏—è M1 –∏ M2

## ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü–û–õ–ù–ê–Ø –ò–ó–û–õ–Ø–¶–ò–Ø –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ê

**–î–∞—Ç–∞:** 2 –¥–µ–∫–∞–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ë–ï–ó–û–ü–ê–°–ù–û - M1 –∏ M2 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã**

---

## üéØ –í–∞—à–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### M1 (–Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç –º–∞–≥–∞–∑–∏–Ω 1)
```
–ú–æ–π–°–∫–ª–∞–¥ ‚Üê‚Üí M1 (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
  
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç:
  - product.offerId (–æ–±—ã—á–Ω–æ–µ –ø–æ–ª–µ –≤ –ú–æ–π–°–∫–ª–∞–¥)
  - –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ú–æ–π–°–∫–ª–∞–¥ ‚Üí –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç
  - –ë–ï–ó middleware
```

### M2 (–Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç –º–∞–≥–∞–∑–∏–Ω 2)
```
–ú–æ–π–°–∫–ª–∞–¥ ‚Üê‚Üí M2 Middleware ‚Üê‚Üí M2

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç:
  - –ê—Ç—Ä–∏–±—É—Ç offerId_M2 (–∫–∞—Å—Ç–æ–º–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç –≤ –ú–æ–π–°–∫–ª–∞–¥)
  - –ù–∞—à middleware
  - –û—Ç–¥–µ–ª—å–Ω—ã–π Campaign ID
```

---

## ‚úÖ –ì–ê–†–ê–ù–¢–ò–ò –ò–ó–û–õ–Ø–¶–ò–ò

### 1. ‚úÖ M2 Middleware –ù–ï –¢–†–û–ì–ê–ï–¢ –æ–±—ã—á–Ω–æ–µ –ø–æ–ª–µ offerId

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚ùå –ù–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ `product.offerId` –≤ –∫–æ–¥–µ
- ‚ùå –ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π `createProduct` –∏–ª–∏ `updateProduct`
- ‚ùå –ù–µ—Ç PUT/POST –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ `/entity/product`
- ‚úÖ Middleware **–¢–û–õ–¨–ö–û –ß–ò–¢–ê–ï–¢** –¥–∞–Ω–Ω—ã–µ –∏–∑ –ú–æ–π–°–∫–ª–∞–¥
- ‚úÖ Middleware —Ä–∞–±–æ—Ç–∞–µ—Ç **–¢–û–õ–¨–ö–û** —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º `offerId_M2`

**–ö–æ–¥:**
```javascript
// src/services/mapperService.js:94
const offerIdAttr = product.attributes?.find(
  attr => attr.id === this.offerIdAttributeId  // ‚Üê –ò—â–µ—Ç –¢–û–õ–¨–ö–û –∞—Ç—Ä–∏–±—É—Ç!
);

const offerId_M2 = offerIdAttr?.value;  // ‚Üê –ë–µ—Ä–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –¢–û–õ–¨–ö–û –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–∞!
```

**–í—ã–≤–æ–¥:** ‚úÖ M2 Middleware **–ù–ï –í–õ–ò–Ø–ï–¢** –Ω–∞ –æ–±—ã—á–Ω–æ–µ –ø–æ–ª–µ `offerId`, –∫–æ—Ç–æ—Ä–æ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç M1

---

### 2. ‚úÖ M1 –ù–ï –í–ò–î–ò–¢ –∞—Ç—Ä–∏–±—É—Ç offerId_M2

**–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ú–æ–π–°–∫–ª–∞–¥ ‚Üí M1:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **–¢–û–õ–¨–ö–û** –æ–±—ã—á–Ω–æ–µ –ø–æ–ª–µ `product.offerId`
- **–ù–ï –ß–ò–¢–ê–ï–¢** –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
- **–ù–ï –ó–ù–ê–ï–¢** –ø—Ä–æ –∞—Ç—Ä–∏–±—É—Ç `offerId_M2`

**–í—ã–≤–æ–¥:** ‚úÖ M1 **–ù–ï –í–ò–î–ò–¢** –∏ **–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢** –∞—Ç—Ä–∏–±—É—Ç `offerId_M2`

---

### 3. ‚úÖ –†–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      –ú–æ–π–°–∫–ª–∞–¥                            ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  –¢–æ–≤–∞—Ä A:                                                ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ offerId: "M1-SKU-001"        ‚Üê M1 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç     ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –ê—Ç—Ä–∏–±—É—Ç offerId_M2: "M2-SKU-001"  ‚Üê M2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  –¢–æ–≤–∞—Ä B:                                                ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ offerId: "M1-SKU-002"        ‚Üê M1 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç     ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –ê—Ç—Ä–∏–±—É—Ç offerId_M2: (–ø—É—Å—Ç–æ)  ‚Üê M2 –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç    ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  –¢–æ–≤–∞—Ä C:                                                ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ offerId: (–ø—É—Å—Ç–æ)             ‚Üê M1 –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç    ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –ê—Ç—Ä–∏–±—É—Ç offerId_M2: "M2-SKU-003"  ‚Üê M2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ                              ‚îÇ
           ‚îÇ                              ‚îÇ
           ‚Üì                              ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  M1 (–Ø–Ω–¥–µ–∫—Å) ‚îÇ            ‚îÇ  M2 (–Ø–Ω–¥–µ–∫—Å) ‚îÇ
    ‚îÇ              ‚îÇ            ‚îÇ              ‚îÇ
    ‚îÇ –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è   ‚îÇ            ‚îÇ Middleware   ‚îÇ
    ‚îÇ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è   ‚îÇ            ‚îÇ              ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–í—ã–≤–æ–¥:** ‚úÖ M1 –∏ M2 –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–†–ê–ó–ù–´–ï –ü–û–õ–Ø** –≤ –ú–æ–π–°–∫–ª–∞–¥

---

## üõ°Ô∏è –ú–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã

### –ó–∞—â–∏—Ç–∞ 1: –†–∞–∑–Ω—ã–µ –ø–æ–ª—è –¥–∞–Ω–Ω—ã—Ö

| –°–∏—Å—Ç–µ–º–∞ | –ü–æ–ª–µ –≤ –ú–æ–π–°–∫–ª–∞–¥ | –¢–∏–ø | Middleware —Ç—Ä–æ–≥–∞–µ—Ç? |
|---------|----------------|------|---------------------|
| M1 | `product.offerId` | –û–±—ã—á–Ω–æ–µ –ø–æ–ª–µ | ‚ùå –ù–ï–¢ |
| M2 | –ê—Ç—Ä–∏–±—É—Ç `offerId_M2` | –ö–∞—Å—Ç–æ–º–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç | ‚úÖ –î–ê (—Ç–æ–ª—å–∫–æ —á–∏—Ç–∞–µ—Ç) |

---

### –ó–∞—â–∏—Ç–∞ 2: Middleware —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞–µ—Ç

**M2 Middleware –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¢–û–õ–¨–ö–û –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è:**

```javascript
// ‚úÖ –†–ê–ó–†–ï–®–ï–ù–û (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
GET /entity/product/metadata        // –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤
GET /entity/product?expand=attributes  // –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
GET /report/stock/bystore           // –ü–æ–ª—É—á–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏

// ‚ùå –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø (–∑–∞–ø–∏—Å—å)
PUT /entity/product/{id}            // –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä - –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø!
POST /entity/product                // –°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä - –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø!
```

**–í—ã–≤–æ–¥:** ‚úÖ Middleware **–ù–ï –ú–û–ñ–ï–¢** –∏–∑–º–µ–Ω–∏—Ç—å –æ–±—ã—á–Ω–æ–µ –ø–æ–ª–µ `offerId`

---

### –ó–∞—â–∏—Ç–∞ 3: –†–∞–∑–Ω—ã–µ Campaign ID

```javascript
// M1 (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
Campaign ID: <M1_CAMPAIGN_ID>  // –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ –ú–æ–π–°–∫–ª–∞–¥

// M2 (–Ω–∞—à middleware)
Campaign ID: <M2_CAMPAIGN_ID>  // –í .env —Ñ–∞–π–ª–µ
```

**–í—ã–≤–æ–¥:** ‚úÖ –ö–∞–∂–¥–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–≤–æ–∏–º –º–∞–≥–∞–∑–∏–Ω–æ–º

---

## üìä –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –¢–æ–≤–∞—Ä —Ç–æ–ª—å–∫–æ –≤ M1

```
–ú–æ–π–°–∫–ª–∞–¥:
  –¢–æ–≤–∞—Ä A
    offerId: "M1-SKU-001"           ‚úÖ –ï—Å—Ç—å
    –ê—Ç—Ä–∏–±—É—Ç offerId_M2: (–ø—É—Å—Ç–æ)     ‚ùå –ù–µ—Ç

M1 (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è): ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç (–≤–∏–¥–∏—Ç offerId)
M2 (middleware):  ‚ùå –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç (–Ω–µ—Ç offerId_M2)

–†–µ–∑—É–ª—å—Ç–∞—Ç: –¢–æ–≤–∞—Ä –¢–û–õ–¨–ö–û –≤ M1
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –¢–æ–≤–∞—Ä —Ç–æ–ª—å–∫–æ –≤ M2

```
–ú–æ–π–°–∫–ª–∞–¥:
  –¢–æ–≤–∞—Ä B
    offerId: (–ø—É—Å—Ç–æ)                ‚ùå –ù–µ—Ç
    –ê—Ç—Ä–∏–±—É—Ç offerId_M2: "M2-SKU-002" ‚úÖ –ï—Å—Ç—å

M1 (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è): ‚ùå –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç (–Ω–µ—Ç offerId)
M2 (middleware):  ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç (–≤–∏–¥–∏—Ç offerId_M2)

–†–µ–∑—É–ª—å—Ç–∞—Ç: –¢–æ–≤–∞—Ä –¢–û–õ–¨–ö–û –≤ M2
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –¢–æ–≤–∞—Ä –≤ –æ–±–æ–∏—Ö –º–∞–≥–∞–∑–∏–Ω–∞—Ö

```
–ú–æ–π–°–∫–ª–∞–¥:
  –¢–æ–≤–∞—Ä C
    offerId: "M1-SKU-003"           ‚úÖ –ï—Å—Ç—å
    –ê—Ç—Ä–∏–±—É—Ç offerId_M2: "M2-SKU-003" ‚úÖ –ï—Å—Ç—å

M1 (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è): ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å M1 (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç offerId)
M2 (middleware):  ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å M2 (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç offerId_M2)

–†–µ–∑—É–ª—å—Ç–∞—Ç: –¢–æ–≤–∞—Ä –≤ –û–ë–û–ò–• –º–∞–≥–∞–∑–∏–Ω–∞—Ö, –Ω–æ –ù–ï–ó–ê–í–ò–°–ò–ú–û!

–í–ê–ñ–ù–û: 
- M1 –ù–ï –í–ò–î–ò–¢ offerId_M2
- M2 –ù–ï –¢–†–û–ì–ê–ï–¢ offerId
- –ö–∞–∂–¥–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ù–ï–ó–ê–í–ò–°–ò–ú–û
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- [x] **YANDEX_CAMPAIGN_ID** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è M2 (–ù–ï M1!)
- [x] **YANDEX_TOKEN** - —Ç–æ–∫–µ–Ω –¥–ª—è M2
- [x] **MS_TOKEN** - –æ–±—â–∏–π —Ç–æ–∫–µ–Ω –ú–æ–π–°–∫–ª–∞–¥ (–æ–¥–Ω–∞ —É—á–µ—Ç–∫–∞)

### –ü–æ–ª—è –≤ –ú–æ–π–°–∫–ª–∞–¥

- [x] **product.offerId** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è M1 (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
- [x] **–ê—Ç—Ä–∏–±—É—Ç offerId_M2** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è M2 (–Ω–∞—à middleware)
- [x] –≠—Ç–æ **–†–ê–ó–ù–´–ï** –ø–æ–ª—è!

### –ö–æ–¥ M2 Middleware

- [x] –ß–∏—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û –∞—Ç—Ä–∏–±—É—Ç `offerId_M2`
- [x] –ù–ï —á–∏—Ç–∞–µ—Ç –æ–±—ã—á–Ω–æ–µ –ø–æ–ª–µ `offerId`
- [x] –ù–ï –∏–∑–º–µ–Ω—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ –ú–æ–π–°–∫–ª–∞–¥
- [x] –ù–ï —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ –ú–æ–π–°–∫–ª–∞–¥
- [x] –†–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û —Å Campaign ID M2

### –ò–∑–æ–ª—è—Ü–∏—è

- [x] M2 –ù–ï –¢–†–û–ì–ê–ï–¢ –ø–æ–ª–µ `offerId` (–∫–æ—Ç–æ—Ä–æ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç M1)
- [x] M1 –ù–ï –í–ò–î–ò–¢ –∞—Ç—Ä–∏–±—É—Ç `offerId_M2` (–∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç M2)
- [x] –†–∞–∑–Ω—ã–µ Campaign ID
- [x] –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Ä–∞–±–æ—Ç–∞

---

## üö® –ß—Ç–æ –ù–ï –ú–û–ñ–ï–¢ –ø–æ–π—Ç–∏ –Ω–µ —Ç–∞–∫

### ‚ùå –†–∏—Å–∫ 1: M2 –∏–∑–º–µ–Ω–∏—Ç offerId –¥–ª—è M1

**–ü–æ—á–µ–º—É –ù–ï –ú–û–ñ–ï–¢ —Å–ª—É—á–∏—Ç—å—Å—è:**
- M2 Middleware **–ù–ï –ò–ú–ï–ï–¢** –∫–æ–¥–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
- –ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π PUT/POST –∫ `/entity/product`
- Middleware **–¢–û–õ–¨–ö–û –ß–ò–¢–ê–ï–¢** –¥–∞–Ω–Ω—ã–µ

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ –∫–æ–¥–µ:** ‚úÖ

---

### ‚ùå –†–∏—Å–∫ 2: M1 —É–≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è M2

**–ü–æ—á–µ–º—É –ù–ï –ú–û–ñ–ï–¢ —Å–ª—É—á–∏—Ç—å—Å—è:**
- M1 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—ã—á–Ω–æ–µ –ø–æ–ª–µ `offerId`
- M2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Ç—Ä–∏–±—É—Ç `offerId_M2`
- –≠—Ç–æ **–†–ê–ó–ù–´–ï** –ø–æ–ª—è –≤ –ú–æ–π–°–∫–ª–∞–¥
- –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è **–ù–ï –ß–ò–¢–ê–ï–¢** –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** ‚úÖ

---

### ‚ùå –†–∏—Å–∫ 3: –ü–µ—Ä–µ–ø—É—Ç–∞—Ç—å Campaign ID

**–ü–æ—á–µ–º—É –ù–ï –ú–û–ñ–ï–¢ —Å–ª—É—á–∏—Ç—å—Å—è:**
- Campaign ID –±–µ—Ä–µ—Ç—Å—è –∏–∑ `.env`
- –ù–µ—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã—Ö ID –≤ –∫–æ–¥–µ
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `this.campaignId`

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
grep YANDEX_CAMPAIGN_ID .env
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —ç—Ç–æ Campaign ID –¥–ª—è M2!
```

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ú–æ–π–°–∫–ª–∞–¥

–û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π —Ç–æ–≤–∞—Ä –≤ –ú–æ–π–°–∫–ª–∞–¥ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å:

```
–¢–æ–≤–∞—Ä: "–ü—Ä–∏–º–µ—Ä —Ç–æ–≤–∞—Ä–∞"
‚îú‚îÄ‚îÄ offerId: "M1-SKU-001"              ‚Üê –î–ª—è M1 (–ù–ï —Ç—Ä–æ–≥–∞–µ–º!)
‚îî‚îÄ‚îÄ –ê—Ç—Ä–∏–±—É—Ç offerId_M2: "M2-SKU-001"   ‚Üê –î–ª—è M2 (–∏—Å–ø–æ–ª—å–∑—É–µ–º!)
```

**–í–∞–∂–Ω–æ:**
- –ü–æ–ª–µ `offerId` - —ç—Ç–æ **–æ–±—ã—á–Ω–æ–µ –ø–æ–ª–µ** (–¥–ª—è M1)
- `offerId_M2` - —ç—Ç–æ **–∫–∞—Å—Ç–æ–º–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç** (–¥–ª—è M2)

---

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –∞—Ç—Ä–∏–±—É—Ç offerId_M2 (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)

1. –ó–∞–π–¥–∏—Ç–µ –≤ –ú–æ–π–°–∫–ª–∞–¥
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ ‚Üí –¢–æ–≤–∞—Ä—ã ‚Üí –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø–æ–ª–µ:
   - –ù–∞–∑–≤–∞–Ω–∏–µ: `offerId_M2`
   - –¢–∏–ø: –°—Ç—Ä–æ–∫–∞
   - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ: –ù–µ—Ç

---

### –®–∞–≥ 3: –ó–∞–ø–æ–ª–Ω–∏—Ç—å offerId_M2 –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ M2

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ M2:
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–æ–≤–∞—Ä –≤ –ú–æ–π–°–∫–ª–∞–¥
2. –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª–µ `offerId_M2`
3. –í–≤–µ–¥–∏—Ç–µ SKU —Ç–æ–≤–∞—Ä–∞ –∏–∑ M2

**–í–∞–∂–Ω–æ:**
- **–ù–ï –¢–†–û–ì–ê–ô–¢–ï** –æ–±—ã—á–Ω–æ–µ –ø–æ–ª–µ `offerId` (–æ–Ω–æ –¥–ª—è M1!)
- –ó–∞–ø–æ–ª–Ω—è–π—Ç–µ **–¢–û–õ–¨–ö–û** –∞—Ç—Ä–∏–±—É—Ç `offerId_M2`

---

### –®–∞–≥ 4: –î–æ–±–∞–≤–∏—Ç—å Campaign ID –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å

1. –û—Ç–∫—Ä–æ–π—Ç–µ `.env`
2. –ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_CAMPAIGN_ID_HERE` –Ω–∞ Campaign ID –º–∞–≥–∞–∑–∏–Ω–∞ M2
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `npm start`

---

### –®–∞–≥ 5: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

**–ü–µ—Ä–≤—ã–µ 30 –º–∏–Ω—É—Ç:**

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ M2 Middleware:**
   ```bash
   tail -f logs/combined.log
   ```
   
   –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   ```
   –ù–∞–π–¥–µ–Ω –∞—Ç—Ä–∏–±—É—Ç offerId_M2 —Å ID: ...
   –ó–∞–≥—Ä—É–∂–µ–Ω–æ –º–∞–ø–ø–∏–Ω–≥–æ–≤: X
   –û—Å—Ç–∞—Ç–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω –≤ M2: offerId_M2=...
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ M1 (–Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç):**
   - –ó–∞–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç M1
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –æ—Å—Ç–∞—Ç–∫–∏ **–ù–ï –ò–ó–ú–ï–ù–ò–õ–ò–°–¨**
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ M2 (–Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç):**
   - –ó–∞–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç M2
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –æ—Å—Ç–∞—Ç–∫–∏ **–û–ë–ù–û–í–õ–Ø–Æ–¢–°–Ø**
   - –¢–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ —Å `offerId_M2`

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

### –ò–∑–æ–ª—è—Ü–∏—è M1 –∏ M2: –ü–û–õ–ù–û–°–¢–¨–Æ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ê

**M1 (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è):**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—ã—á–Ω–æ–µ –ø–æ–ª–µ `offerId`
- ‚úÖ –ù–ï –í–ò–î–ò–¢ –∞—Ç—Ä–∏–±—É—Ç `offerId_M2`
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ
- ‚úÖ **–ù–ï –ó–ê–¢–†–û–ù–£–¢** M2 Middleware

**M2 (–Ω–∞—à middleware):**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Ç—Ä–∏–±—É—Ç `offerId_M2`
- ‚úÖ –ù–ï –¢–†–û–ì–ê–ï–¢ –æ–±—ã—á–Ω–æ–µ –ø–æ–ª–µ `offerId`
- ‚úÖ –¢–û–õ–¨–ö–û –ß–ò–¢–ê–ï–¢ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ú–æ–π–°–∫–ª–∞–¥
- ‚úÖ **–ù–ï –í–õ–ò–Ø–ï–¢** –Ω–∞ M1

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚ùå M2 Middleware **–ù–ï –ú–û–ñ–ï–¢** –∏–∑–º–µ–Ω–∏—Ç—å `offerId` (–Ω–µ—Ç –∫–æ–¥–∞ –¥–ª—è —ç—Ç–æ–≥–æ)
- ‚ùå M1 **–ù–ï –í–ò–î–ò–¢** –∞—Ç—Ä–∏–±—É—Ç `offerId_M2` (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ —á–∏—Ç–∞–µ—Ç –∞—Ç—Ä–∏–±—É—Ç—ã)
- ‚úÖ –ö–∞–∂–¥–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç **–ù–ï–ó–ê–í–ò–°–ò–ú–û**
- ‚úÖ –†–∞–∑–Ω—ã–µ Campaign ID
- ‚úÖ –†–∞–∑–Ω—ã–µ –ø–æ–ª—è –¥–∞–Ω–Ω—ã—Ö

---

## üéØ –°–¢–ê–¢–£–°: –ë–ï–ó–û–ü–ê–°–ù–û –î–õ–Ø –ó–ê–ü–£–°–ö–ê

**–ú–æ–∂–µ—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ:**
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å Campaign ID M2 –≤ `.env`
2. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å middleware
3. ‚úÖ M1 –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –æ–±—ã—á–Ω–æ
4. ‚úÖ M2 –Ω–∞—á–Ω–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ middleware

**M1 –ù–ï –£–ó–ù–ê–ï–¢ –ø—Ä–æ M2, –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç!** üîí

---

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 2 –¥–µ–∫–∞–±—Ä—è 2024  
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü–û–õ–ù–ê–Ø –ò–ó–û–õ–Ø–¶–ò–Ø –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ê

---

*–≠—Ç–æ—Ç –æ—Ç—á–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —á—Ç–æ M2 Middleware —Ä–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º offerId_M2 –∏ –ù–ï –í–õ–ò–Ø–ï–¢ –Ω–∞ –æ–±—ã—á–Ω–æ–µ –ø–æ–ª–µ offerId, –∫–æ—Ç–æ—Ä–æ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç M1.*
